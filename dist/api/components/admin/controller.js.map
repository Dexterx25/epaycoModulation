{"version":3,"file":"controller.js","sourceRoot":"","sources":["../../../../src/api/components/admin/controller.ts"],"names":[],"mappings":"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","sourcesContent":["import bcrypt from \"bcrypt\"\nimport controllerAuth from \"../auth/index\"\nimport {midlleHandleError, Validator} from \"../../../utils/actions/admins/index\"\nimport mailValidator from \"./mailValidator\"\n\nexport default function (injectedStore:any, injectedCache:any) {\n    let cache = injectedCache\n    let store = injectedStore\n\n    if(!store ){\n          store = require('../../../store/dummy')\n    }\n    if(!cache ){\n        cache = require('../../../store/dummy')\n    }\n  let table = 'admins'\n  let procedence = '[USER CONTROLLER]'\n\n const  insert = async ({datas, type}:any) => {\n   console.warn('DATAS controller--->', datas, type)\n      return new Promise(async(resolve, reject)=>{\n      const responValidator = await Validator(datas)\n       if(responValidator){\n          reject({msg:responValidator});\n          return false;\n       }\n     const body: object = {\n      data:{\n        names:datas.names,\n        surnames:datas.surnames,\n        full_name:`${datas.names} ${datas.surnames}`,\n        prefix_number:datas.prefix_number,\n        weight:datas.weight,\n        height:datas.height,\n        phone_number:datas.phone_number,\n        email:datas.email,\n        date_birtday:datas.date_birtday,\n        encrypted_password:await bcrypt.hash(datas.password, 5),\n        user_category:'admin_user'\n        },\n    type:type\n   }\n   const {data} : any = body\n   await mailValidator(data, reject, datas)\ntry {\n const registerRespon: any = await store.upsert(table, body)\n  console.log('REgisterRespon--->', registerRespon)\n\n  const responAuth = await controllerAuth.upsert(registerRespon,{\n    encrypted_password:await bcrypt.hash(datas.password, 5),\n    id:registerRespon.id,\n    email:registerRespon.email \n    }, 'admins')\n    console.log('returning responAuth.--->', responAuth)\n    \n    const {email} = Object.assign(registerRespon, responAuth)\n    console.log('email controller Auth-->', email)\n    \n   const res =  await controllerAuth.insert(email, datas.password, table)  \n  resolve(res)\n} catch (e:any) {\n    console.log('error controll admin--->', e)\n   await midlleHandleError(e, table, body, resolve, reject)\n\n}\n \n})\n\n}\nasync function get(data:any){\n    return new Promise( async (resolve, reject)=>{\n          const {filter} = data\n          const theData = {type:'getUser', querys:filter}\n          console.log('the filter--->', filter)\n          let user = await cache.get(filter.id, table)\n            if(!user){\n                console.log('no estaba en cachee, buscando en db')\n                user = await store.get(theData, table)\n                cache.upsert(user, table)\n            }\n         resolve(user)\n    })\n\n}\nreturn {\n  insert,\n  get\n}\n\n}"]}